%=========================================================================
%			2004/12/04バージョン
%=========================================================================

	function [Hx,Hy,Hz] = Biot_Savart(Ox,Oy,Oz,X1,Y1,Z1,X2,Y2,Z2)

%-------------------------------------------------------------------------
%			メモリ制限による分割
%-------------------------------------------------------------------------

	Os = size(Ox,1);
	edges = size(X1,2);

%-------------------------------------------------------------------------
%			初期化
%-------------------------------------------------------------------------

	Hx = [];
	Hy = [];
	Hz = [];

%-------------------------------------------------------------------------
%			サブブロックの計算
%-------------------------------------------------------------------------

	X21 = ones(Os,1)*(X2-X1);
	Y21 = ones(Os,1)*(Y2-Y1);
	Z21 = ones(Os,1)*(Z2-Z1);
		R21  = (X21.^2 + Y21.^2 + Z21.^2);

	OxX1 = Ox(1:Os)*ones(1,edges)-ones(Os,1)*X1;
	OyY1 = Oy(1:Os)*ones(1,edges)-ones(Os,1)*Y1;
	OzZ1 = Oz(1:Os)*ones(1,edges)-ones(Os,1)*Z1;
		OR1 = sqrt(OxX1.^2 + OyY1.^2 + OzZ1.^2);
	OxX2 = Ox(1:Os)*ones(1,edges)-ones(Os,1)*X2;
	OyY2 = Oy(1:Os)*ones(1,edges)-ones(Os,1)*Y2;
	OzZ2 = Oz(1:Os)*ones(1,edges)-ones(Os,1)*Z2;
		OR2 = sqrt(OxX2.^2 + OyY2.^2 + OzZ2.^2);

	O121 = (OxX1.*X21 + OyY1.*Y21 + OzZ1.*Z21);
	O221 = (OxX2.*X21 + OyY2.*Y21 + OzZ2.*Z21);

	RcosO12 =  O121./OR1;
	RcosO21 = -O221./OR2;
	Lx1 = OxX1 - O121.*X21./R21;
	Ly1 = OyY1 - O121.*Y21./R21;
	Lz1 = OzZ1 - O121.*Z21./R21;
		L1 = (Lx1.^2 + Ly1.^2 + Lz1.^2)+eps;

	Hx = 1/4/pi.*(Y21.*Lz1-Z21.*Ly1)./L1./R21.*(RcosO12+RcosO21);
	Hy = 1/4/pi.*(Z21.*Lx1-X21.*Lz1)./L1./R21.*(RcosO12+RcosO21);
	Hz = 1/4/pi.*(X21.*Ly1-Y21.*Lx1)./L1./R21.*(RcosO12+RcosO21);

