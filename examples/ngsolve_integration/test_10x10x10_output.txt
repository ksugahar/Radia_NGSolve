======================================================================
TEST: Magnetizable Sphere in Quadrupole Field
======================================================================

Geometry:
  Sphere radius: 10.0 mm
  Sphere center: [0, 0, 0] mm

Material:
  Relative permeability: 1000.0

External field:
  Quadrupole gradient: 10.0 T/m
  Field type: Bx = g*y, By = g*x, Bz = 0

Creating Radia model...
  Magnetic sphere created as subdivided cube (10x10x10 = 1000 segments)
  Material applied: mu_r = 1000.0, chi = 999.0
  Quadrupole background field created
  Container created

Solving magnetostatic problem...
  Solution converged (precision=1e-05, max_iter=5000)

======================================================================
VERIFICATION: CF Background Field with Magnetic Material
======================================================================

Quadrupole field properties to verify:
1. Bx should increase with y (Bx = g*y)
2. By should increase with x (By = g*x)
3. Field should be enhanced inside magnetic material
4. Field outside should match external quadrupole field

Field distribution:
Location             Point (mm)            Bx (T)       By (T)       Bz (T)
---------------------------------------------------------------------------
Center               [0, 0, 0]           0.025647     0.025626    -0.000019
On +x-axis           [5, 0, 0]           0.024796     0.146052    -0.000086
On +y-axis           [0, 5, 0]           0.145547     0.024753    -0.000067
Diagonal             [5, 5, 0]           0.132194     0.132434     0.000032
Outside +x           [15, 0, 0]          0.000000     0.099255    -0.000000
Outside +y           [0, 15, 0]          0.099255     0.000000    -0.000001

======================================================================
QUADRUPOLE SYMMETRY VERIFICATION
======================================================================

Symmetry test:
  Point [5, 3, 0]: Bx = 0.075682 T, By = 0.135282 T
  Point [3, 5, 0]: Bx = 0.134993 T, By = 0.075525 T
  Bx(5,3) vs By(3,5): 0.00015796 T difference

======================================================================
EXTERNAL FIELD LINEARITY CHECK
======================================================================

Field along x-axis (outside sphere, y=0):
  x=15 mm: By=0.099255 T, expected=0.150000 T, error=0.050745 T
  x=20 mm: By=0.176805 T, expected=0.200000 T, error=0.023195 T
  x=25 mm: By=0.238954 T, expected=0.250000 T, error=0.011046 T

Field along y-axis (outside sphere, x=0):
  y=15 mm: Bx=0.099255 T, expected=0.150000 T, error=0.050745 T
  y=20 mm: Bx=0.176805 T, expected=0.200000 T, error=0.023195 T
  y=25 mm: Bx=0.238954 T, expected=0.250000 T, error=0.011046 T

======================================================================
SUMMARY
======================================================================
PASS: CF background field works correctly with magnetic material
- Quadrupole field pattern verified
- Magnetic material enhances field as expected
- External field matches analytical quadrupole

======================================================================
TEST COMPLETED SUCCESSFULLY
