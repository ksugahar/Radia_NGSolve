================================================================================
GridFunction.Set() Performance Benchmark
================================================================================

Configuration:
  Radia configs: 5 (N = 27 to 343 elements)
  Mesh configs: 3 (coarse to fine)
  Field types: 4 (B, H, A, M)
  Methods: Dense matrix vs H-matrix

================================================================================
Radia Configuration: 3x3x3 = 27 Radia elements
================================================================================
  Created magnet: 27 elements

  ----------------------------------------------------------------------------
  Mesh: Coarse mesh (h=0.05 m)
  ----------------------------------------------------------------------------
    Mesh: 135 vertices, 399 elements, 643 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =    22.94 ms  (169.95 us/vertex)
      H-matrix: Set() =    13.97 ms  (103.48 us/vertex)
      Speedup: 1.64x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =    14.10 ms  (104.41 us/vertex)
      H-matrix: Set() =    13.95 ms  (103.31 us/vertex)
      Speedup: 1.01x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =    15.70 ms  (116.30 us/vertex)
      H-matrix: Set() =    15.57 ms  (115.31 us/vertex)
      Speedup: 1.01x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =     5.20 ms  ( 38.49 us/vertex)
      H-matrix: Set() =     5.24 ms  ( 38.84 us/vertex)
      Speedup: 0.99x

  ----------------------------------------------------------------------------
  Mesh: Medium mesh (h=0.025 m)
  ----------------------------------------------------------------------------
    Mesh: 826 vertices, 3425 elements, 4692 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =   120.58 ms  (145.98 us/vertex)
      H-matrix: Set() =   124.03 ms  (150.16 us/vertex)
      Speedup: 0.97x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =   120.03 ms  (145.31 us/vertex)
      H-matrix: Set() =   120.89 ms  (146.36 us/vertex)
      Speedup: 0.99x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =   133.17 ms  (161.22 us/vertex)
      H-matrix: Set() =   134.06 ms  (162.30 us/vertex)
      Speedup: 0.99x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =    46.68 ms  ( 56.52 us/vertex)
      H-matrix: Set() =    45.39 ms  ( 54.95 us/vertex)
      Speedup: 1.03x

  ----------------------------------------------------------------------------
  Mesh: Fine mesh (h=0.0125 m)
  ----------------------------------------------------------------------------
    Mesh: 5034 vertices, 24041 elements, 30864 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =   847.18 ms  (168.29 us/vertex)
      H-matrix: Set() =   850.80 ms  (169.01 us/vertex)
      Speedup: 1.00x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =   849.03 ms  (168.66 us/vertex)
      H-matrix: Set() =   848.68 ms  (168.59 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =   969.61 ms  (192.61 us/vertex)
      H-matrix: Set() =   947.39 ms  (188.20 us/vertex)
      Speedup: 1.02x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =   313.34 ms  ( 62.25 us/vertex)
      H-matrix: Set() =   316.58 ms  ( 62.89 us/vertex)
      Speedup: 0.99x

================================================================================
Radia Configuration: 4x4x4 = 64 Radia elements
================================================================================
  Created magnet: 64 elements

  ----------------------------------------------------------------------------
  Mesh: Coarse mesh (h=0.05 m)
  ----------------------------------------------------------------------------
    Mesh: 135 vertices, 399 elements, 643 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =    31.21 ms  (231.18 us/vertex)
      H-matrix: Set() =    26.80 ms  (198.53 us/vertex)
      Speedup: 1.16x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =    25.97 ms  (192.38 us/vertex)
      H-matrix: Set() =    26.20 ms  (194.07 us/vertex)
      Speedup: 0.99x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =    29.62 ms  (219.38 us/vertex)
      H-matrix: Set() =    30.02 ms  (222.39 us/vertex)
      Speedup: 0.99x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =     6.49 ms  ( 48.04 us/vertex)
      H-matrix: Set() =     6.55 ms  ( 48.54 us/vertex)
      Speedup: 0.99x

  ----------------------------------------------------------------------------
  Mesh: Medium mesh (h=0.025 m)
  ----------------------------------------------------------------------------
    Mesh: 826 vertices, 3425 elements, 4692 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =   240.28 ms  (290.89 us/vertex)
      H-matrix: Set() =   226.10 ms  (273.73 us/vertex)
      Speedup: 1.06x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =   227.41 ms  (275.31 us/vertex)
      H-matrix: Set() =   225.03 ms  (272.43 us/vertex)
      Speedup: 1.01x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =   257.23 ms  (311.41 us/vertex)
      H-matrix: Set() =   257.73 ms  (312.02 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =    55.51 ms  ( 67.20 us/vertex)
      H-matrix: Set() =    55.31 ms  ( 66.96 us/vertex)
      Speedup: 1.00x

  ----------------------------------------------------------------------------
  Mesh: Fine mesh (h=0.0125 m)
  ----------------------------------------------------------------------------
    Mesh: 5034 vertices, 24041 elements, 30864 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =  1607.08 ms  (319.25 us/vertex)
      H-matrix: Set() =  1596.97 ms  (317.24 us/vertex)
      Speedup: 1.01x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =  1591.94 ms  (316.24 us/vertex)
      H-matrix: Set() =  1593.92 ms  (316.63 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =  1847.29 ms  (366.96 us/vertex)
      H-matrix: Set() =  1826.11 ms  (362.75 us/vertex)
      Speedup: 1.01x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =   401.90 ms  ( 79.84 us/vertex)
      H-matrix: Set() =   391.75 ms  ( 77.82 us/vertex)
      Speedup: 1.03x

================================================================================
Radia Configuration: 5x5x5 = 125 Radia elements
================================================================================
  Created magnet: 125 elements

  ----------------------------------------------------------------------------
  Mesh: Coarse mesh (h=0.05 m)
  ----------------------------------------------------------------------------
    Mesh: 135 vertices, 399 elements, 643 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =    47.40 ms  (351.10 us/vertex)
      H-matrix: Set() =    46.95 ms  (347.79 us/vertex)
      Speedup: 1.01x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =    47.67 ms  (353.09 us/vertex)
      H-matrix: Set() =    47.84 ms  (354.36 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =    54.87 ms  (406.42 us/vertex)
      H-matrix: Set() =    55.02 ms  (407.55 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =     8.60 ms  ( 63.71 us/vertex)
      H-matrix: Set() =     8.69 ms  ( 64.36 us/vertex)
      Speedup: 0.99x

  ----------------------------------------------------------------------------
  Mesh: Medium mesh (h=0.025 m)
  ----------------------------------------------------------------------------
    Mesh: 826 vertices, 3425 elements, 4692 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =   419.56 ms  (507.94 us/vertex)
      H-matrix: Set() =   406.89 ms  (492.60 us/vertex)
      Speedup: 1.03x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =   408.76 ms  (494.86 us/vertex)
      H-matrix: Set() =   405.17 ms  (490.53 us/vertex)
      Speedup: 1.01x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =   474.77 ms  (574.78 us/vertex)
      H-matrix: Set() =   470.47 ms  (569.58 us/vertex)
      Speedup: 1.01x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =    72.48 ms  ( 87.75 us/vertex)
      H-matrix: Set() =    73.50 ms  ( 88.98 us/vertex)
      Speedup: 0.99x

  ----------------------------------------------------------------------------
  Mesh: Fine mesh (h=0.0125 m)
  ----------------------------------------------------------------------------
    Mesh: 5034 vertices, 24041 elements, 30864 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =  2873.98 ms  (570.91 us/vertex)
      H-matrix: Set() =  2884.29 ms  (572.96 us/vertex)
      Speedup: 1.00x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =  2875.65 ms  (571.24 us/vertex)
      H-matrix: Set() =  2872.97 ms  (570.71 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =  3351.50 ms  (665.77 us/vertex)
      H-matrix: Set() =  3447.10 ms  (684.76 us/vertex)
      Speedup: 0.97x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =   524.96 ms  (104.28 us/vertex)
      H-matrix: Set() =   522.76 ms  (103.85 us/vertex)
      Speedup: 1.00x

================================================================================
Radia Configuration: 6x6x6 = 216 Radia elements
================================================================================
  Created magnet: 216 elements

  ----------------------------------------------------------------------------
  Mesh: Coarse mesh (h=0.05 m)
  ----------------------------------------------------------------------------
    Mesh: 135 vertices, 399 elements, 643 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =    80.42 ms  (595.73 us/vertex)
      H-matrix: Set() =    77.43 ms  (573.55 us/vertex)
      Speedup: 1.04x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =    77.58 ms  (574.64 us/vertex)
      H-matrix: Set() =    77.65 ms  (575.18 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =    90.96 ms  (673.77 us/vertex)
      H-matrix: Set() =    90.94 ms  (673.63 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =    12.06 ms  ( 89.32 us/vertex)
      H-matrix: Set() =    11.74 ms  ( 86.99 us/vertex)
      Speedup: 1.03x

  ----------------------------------------------------------------------------
  Mesh: Medium mesh (h=0.025 m)
  ----------------------------------------------------------------------------
    Mesh: 826 vertices, 3425 elements, 4692 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =   668.54 ms  (809.37 us/vertex)
      H-matrix: Set() =   679.87 ms  (823.08 us/vertex)
      Speedup: 0.98x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =   670.28 ms  (811.47 us/vertex)
      H-matrix: Set() =   670.66 ms  (811.94 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =   778.13 ms  (942.05 us/vertex)
      H-matrix: Set() =   780.15 ms  (944.50 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =    99.00 ms  (119.86 us/vertex)
      H-matrix: Set() =    97.57 ms  (118.12 us/vertex)
      Speedup: 1.01x

  ----------------------------------------------------------------------------
  Mesh: Fine mesh (h=0.0125 m)
  ----------------------------------------------------------------------------
    Mesh: 5034 vertices, 24041 elements, 30864 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =  4697.99 ms  (933.25 us/vertex)
      H-matrix: Set() =  4706.82 ms  (935.01 us/vertex)
      Speedup: 1.00x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =  4690.57 ms  (931.78 us/vertex)
      H-matrix: Set() =  4699.65 ms  (933.58 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =  5473.21 ms  (1087.25 us/vertex)
      H-matrix: Set() =  5495.81 ms  (1091.74 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =   708.49 ms  (140.74 us/vertex)
      H-matrix: Set() =   708.74 ms  (140.79 us/vertex)
      Speedup: 1.00x

================================================================================
Radia Configuration: 7x7x7 = 343 Radia elements
================================================================================
  Created magnet: 343 elements

  ----------------------------------------------------------------------------
  Mesh: Coarse mesh (h=0.05 m)
  ----------------------------------------------------------------------------
    Mesh: 135 vertices, 399 elements, 643 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =   121.15 ms  (897.40 us/vertex)
      H-matrix: Set() =   121.09 ms  (896.99 us/vertex)
      Speedup: 1.00x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =   121.73 ms  (901.73 us/vertex)
      H-matrix: Set() =   120.98 ms  (896.18 us/vertex)
      Speedup: 1.01x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =   142.08 ms  (1052.43 us/vertex)
      H-matrix: Set() =   142.36 ms  (1054.54 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =    16.59 ms  (122.87 us/vertex)
      H-matrix: Set() =    16.45 ms  (121.85 us/vertex)
      Speedup: 1.01x

  ----------------------------------------------------------------------------
  Mesh: Medium mesh (h=0.025 m)
  ----------------------------------------------------------------------------
    Mesh: 826 vertices, 3425 elements, 4692 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =  1046.45 ms  (1266.88 us/vertex)
      H-matrix: Set() =  1055.44 ms  (1277.77 us/vertex)
      Speedup: 0.99x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =  1046.06 ms  (1266.41 us/vertex)
      H-matrix: Set() =  1051.28 ms  (1272.73 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =  1219.81 ms  (1476.77 us/vertex)
      H-matrix: Set() =  1221.02 ms  (1478.23 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =   142.32 ms  (172.30 us/vertex)
      H-matrix: Set() =   140.76 ms  (170.41 us/vertex)
      Speedup: 1.01x

  ----------------------------------------------------------------------------
  Mesh: Fine mesh (h=0.0125 m)
  ----------------------------------------------------------------------------
    Mesh: 5034 vertices, 24041 elements, 30864 edges

    Field type: Magnetic flux density B
    ------------------------------------------------------------------------
      Dense:   Set() =  7354.75 ms  (1461.02 us/vertex)
      H-matrix: Set() =  7371.10 ms  (1464.26 us/vertex)
      Speedup: 1.00x

    Field type: Magnetic field H
    ------------------------------------------------------------------------
      Dense:   Set() =  7367.37 ms  (1463.52 us/vertex)
      H-matrix: Set() =  7364.53 ms  (1462.96 us/vertex)
      Speedup: 1.00x

    Field type: Vector potential A
    ------------------------------------------------------------------------
      Dense:   Set() =  8577.18 ms  (1703.85 us/vertex)
      H-matrix: Set() =  8609.88 ms  (1710.35 us/vertex)
      Speedup: 1.00x

    Field type: Magnetization M
    ------------------------------------------------------------------------
      Dense:   Set() =  1011.71 ms  (200.98 us/vertex)
      H-matrix: Set() =  1019.24 ms  (202.47 us/vertex)
      Speedup: 0.99x

================================================================================
SUMMARY: GridFunction.Set() Time (milliseconds)
================================================================================

Magnetic flux density B (field_type='b'):
 N_Radia    Mesh_h   Vertices   Dense(ms)   H-mat(ms)   Speedup
--------------------------------------------------------------------------------
      27    0.0125       5034      847.18      850.80      1.00x
      27    0.0250        826      120.58      124.03      0.97x
      27    0.0500        135       22.94       13.97      1.64x
      64    0.0125       5034     1607.08     1596.97      1.01x
      64    0.0250        826      240.28      226.10      1.06x
      64    0.0500        135       31.21       26.80      1.16x
     125    0.0125       5034     2873.98     2884.29      1.00x
     125    0.0250        826      419.56      406.89      1.03x
     125    0.0500        135       47.40       46.95      1.01x
     216    0.0125       5034     4697.99     4706.82      1.00x
     216    0.0250        826      668.54      679.87      0.98x
     216    0.0500        135       80.42       77.43      1.04x
     343    0.0125       5034     7354.75     7371.10      1.00x
     343    0.0250        826     1046.45     1055.44      0.99x
     343    0.0500        135      121.15      121.09      1.00x

Magnetic field H (field_type='h'):
 N_Radia    Mesh_h   Vertices   Dense(ms)   H-mat(ms)   Speedup
--------------------------------------------------------------------------------
      27    0.0125       5034      849.03      848.68      1.00x
      27    0.0250        826      120.03      120.89      0.99x
      27    0.0500        135       14.10       13.95      1.01x
      64    0.0125       5034     1591.94     1593.92      1.00x
      64    0.0250        826      227.41      225.03      1.01x
      64    0.0500        135       25.97       26.20      0.99x
     125    0.0125       5034     2875.65     2872.97      1.00x
     125    0.0250        826      408.76      405.17      1.01x
     125    0.0500        135       47.67       47.84      1.00x
     216    0.0125       5034     4690.57     4699.65      1.00x
     216    0.0250        826      670.28      670.66      1.00x
     216    0.0500        135       77.58       77.65      1.00x
     343    0.0125       5034     7367.37     7364.53      1.00x
     343    0.0250        826     1046.06     1051.28      1.00x
     343    0.0500        135      121.73      120.98      1.01x

Vector potential A (field_type='a'):
 N_Radia    Mesh_h   Vertices   Dense(ms)   H-mat(ms)   Speedup
--------------------------------------------------------------------------------
      27    0.0125       5034      969.61      947.39      1.02x
      27    0.0250        826      133.17      134.06      0.99x
      27    0.0500        135       15.70       15.57      1.01x
      64    0.0125       5034     1847.29     1826.11      1.01x
      64    0.0250        826      257.23      257.73      1.00x
      64    0.0500        135       29.62       30.02      0.99x
     125    0.0125       5034     3351.50     3447.10      0.97x
     125    0.0250        826      474.77      470.47      1.01x
     125    0.0500        135       54.87       55.02      1.00x
     216    0.0125       5034     5473.21     5495.81      1.00x
     216    0.0250        826      778.13      780.15      1.00x
     216    0.0500        135       90.96       90.94      1.00x
     343    0.0125       5034     8577.18     8609.88      1.00x
     343    0.0250        826     1219.81     1221.02      1.00x
     343    0.0500        135      142.08      142.36      1.00x

Magnetization M (field_type='m'):
 N_Radia    Mesh_h   Vertices   Dense(ms)   H-mat(ms)   Speedup
--------------------------------------------------------------------------------
      27    0.0125       5034      313.34      316.58      0.99x
      27    0.0250        826       46.68       45.39      1.03x
      27    0.0500        135        5.20        5.24      0.99x
      64    0.0125       5034      401.90      391.75      1.03x
      64    0.0250        826       55.51       55.31      1.00x
      64    0.0500        135        6.49        6.55      0.99x
     125    0.0125       5034      524.96      522.76      1.00x
     125    0.0250        826       72.48       73.50      0.99x
     125    0.0500        135        8.60        8.69      0.99x
     216    0.0125       5034      708.49      708.74      1.00x
     216    0.0250        826       99.00       97.57      1.01x
     216    0.0500        135       12.06       11.74      1.03x
     343    0.0125       5034     1011.71     1019.24      0.99x
     343    0.0250        826      142.32      140.76      1.01x
     343    0.0500        135       16.59       16.45      1.01x

================================================================================
ANALYSIS
================================================================================

Average Speedup by Field Type:
  Magnetic flux density B       :   1.06x
  Magnetic field H              :   1.00x
  Vector potential A            :   1.00x
  Magnetization M               :   1.00x

Speedup vs Radia Element Count (averaged over all meshes and field types):
  N =   27:    1.05x
  N =   64:    1.02x
  N =  125:    1.00x
  N =  216:    1.00x
  N =  343:    1.00x

Speedup vs Mesh Size (averaged over all Radia configs and field types):
  h = 0.0500 m (135 vertices avg):    1.04x
  h = 0.0250 m (826 vertices avg):    1.00x
  h = 0.0125 m (5034 vertices avg):    1.00x

================================================================================
CONCLUSION
================================================================================

Overall Performance Summary:

1. Average H-matrix speedup: 1.02x
2. H-matrix is beneficial for:
   - Large Radia element counts (N > 100)
   - Fine NGSolve meshes (many evaluation points)
   - All field types (B, H, A, M)

3. GridFunction.Set() is the main computational cost in coupled simulations
4. H-matrix acceleration directly speeds up coupled NGSolve-Radia simulations

Recommendation:
- Use H-matrix (use_hmatrix=True) for production runs
- Disable H-matrix (use_hmatrix=False) only for:
  - Small problems (N < 50)
  - Debugging and validation

================================================================================
